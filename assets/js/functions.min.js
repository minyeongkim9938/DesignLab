function sanitize(val){return/^[0-9]*$/.test(val)?Math.abs(Math.round(1*val)):0}function updateURL(){var metrics=myGrid.getMetrics();document.location.hash="/"+[metrics.maxWidth,metrics.columns,metrics.gutter,metrics.margin].join("/")}function getURLMetrics(){var URLMetrics=document.location.hash.split("/");URLMetrics.length>=5&&myGrid.set({maxWidth:sanitize(URLMetrics[1]),columns:sanitize(URLMetrics[2]),gutter:sanitize(URLMetrics[3]),margin:sanitize(URLMetrics[4])}),myGrid.change()}!function(){for(var method,noop=function(){},methods=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],length=methods.length,console=window.console=window.console||{};length--;)method=methods[length],console[method]||(console[method]=noop)}();var myGrid=function(){var t={},metrics={maxWidth:960,columns:4,gutter:20,margin:20},calculateColwidth=function(maxWidth,columns,gutter,margin){return Math.floor((maxWidth-((columns-1)*gutter+2*margin))/columns)},calculatePagewidth=function(colWidth,columns,gutter,margin){return colWidth*columns+(columns-1)*gutter+2*margin},setMetric=function(name,val){"undefined"!=typeof metrics[name]&&"number"==typeof val&&(val=0>val?0:val,metrics[name]=Math.abs(val))};return t.set=function(){var a=arguments;"string"==typeof a[0]&&"number"==typeof a[1]?setMetric(a[0],a[1]):"object"==typeof a[0]&&$.each(a[0],function(n,v){setMetric(n,v)}),t.change()},t.getColWidth=function(){return calculateColwidth(metrics.maxWidth,metrics.columns,metrics.gutter,metrics.margin)},t.getPageWidth=function(){var colWidth=t.getColWidth();return calculatePagewidth(colWidth,metrics.columns,metrics.gutter,metrics.margin)},t.getMetrics=function(){var calculated={colWidth:t.getColWidth(),pageWidth:t.getPageWidth()},m=_.clone(metrics);return $.extend(m,calculated)},t.isSpotOn=function(){return t.getPageWidth()==metrics.maxWidth},t.isPossible=function(){return t.getColWidth()>0&&metrics.columns>0},t.change=function(){},t.metrics=metrics,t}(),v=1.1,highlight,hash=null;myGrid.change=function(){var metrics=myGrid.getMetrics(),possible=myGrid.isPossible();if(possible){metrics.pageClass=myGrid.isSpotOn()?"":"warning";var v=template.render("tmp_visualize",$.extend(metrics,{highlight:highlight}));$("#result").html(v),$(".downloadButton").prop("disabled",!1)}else metrics.pageClass="error",$("#visualization").addClass("error"),$(".downloadButton").prop("disabled",!0);var out=possible?template.render("tmp_metrics",metrics):template.render("tmp_metrics_error",metrics);$("#results").html(out),$.each(metrics,function(n,v){$("[name="+n+"]").each(function(){if($(this).is("[type!=hidden]:focus")){var sel=this.selectionEnd;$(this).val(v),this.setSelectionRange(sel,sel)}else $(this).val(v)})}),"undefined"==typeof myGrid.changed&&(mixpanel.track("Grid changed"),myGrid.changed=!0)};var isValidNumberKey=function(){var validKeys=" 48 49 50 51 52 53 54 55 56 57 96 97 98 99 100 101 102 103 104 105 8 46 38 40 ",f=function(key){return-1!=validKeys.indexOf(" "+key+" ")};return f}();$(function(){$.cookie.json=!0,$("#gridForm input").keydown(function(e){var v=sanitize($(this).val());38==e.which?myGrid.set(this.name,v+1):40==e.which&&myGrid.set(this.name,v-1)}).keyup(function(e){if(!isValidNumberKey(e.which))return!1;var v=$(this).val();return""===v?!1:(myGrid.set(this.name,sanitize(v)),updateURL(),void 0)}),$("#input_gutter, #input_margin, #input_width, #input_columns").focus(function(){highlight=$(this).attr("name"),$(this).parent().parent().addClass("selected"),myGrid.change()}).blur(function(){highlight="",$(this).parent().parent().removeClass("selected"),myGrid.change()}),$(".tip .toggle").click(function(e){e.preventDefault();var tip=$(this).parent();tip.hasClass("on")?($(this).text("Show Tip"),tip.removeClass("on"),tip.find("span").slideUp(),$.cookie("gridCalculator",{v:v,tip:!1})):($(this).text("Hide Tip"),tip.addClass("on"),tip.find("span").slideDown(),$.cookie("gridCalculator",{v:v,tip:!0}))}),$("#download .downloadButton").click(function(){var type,val=$(this).attr("value"),metrics=myGrid.getMetrics();val.match(/illustrator/i)?type="ai":val.match(/photoshop/i)?type="ps":val.match(/other/i)&&(type="png");var metricString="/"+[metrics.maxWidth,metrics.columns,metrics.gutter,metrics.margin].join("/");_gaq.push(["_trackEvent","Download grid",type,metrics.maxWidth+""],["_trackEvent","Metrics","metrics",metricString]),mixpanel.track("Download grid",{"File type":type,"Max width":metrics.maxWidth,Columns:metrics.columns,"Page width":metrics.pageWidth})}).tipTip({delay:0,maxWidth:"238px"}),$("#affLink a").click(function(){_gaq.push(["_trackEvent","Affiliate click",$(this).attr("href")])}),$(".gridLink").click(function(e){e.preventDefault(),document.location.hash=$(this).attr("href"),getURLMetrics(),calculate()});var cookie=$.cookie("gridCalculator");cookie&&cookie.v==v&&cookie.tip===!1&&$(".tip .toggle").click(),getURLMetrics()});